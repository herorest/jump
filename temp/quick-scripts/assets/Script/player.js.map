{"version":3,"sources":["player.js"],"names":["cc","Class","extends","Component","properties","jumpAudio","type","AudioClip","default","jumpStandByAudio","onLoad","jumpStandByAudioId","jumpAudioId","jumpId","isJump","direction","power","maxDistance","distance","speed","user","find","node","rotateNode","onJump","bind","readyJump","audioEngine","play","runAction","scaleTo","callback","targetPos","v2","x","y","jumpToBlock","stop","stopAllActions","resetAction","jumpAction","jumpTo","rotateAction","rotateBy","sequence","callFunc","rotation","Math","random","update","dt","getWorldPlayerPos","parent","convertToWorldSpaceAR","position","getDirection"],"mappings":"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","file":"player.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        jumpAudio:{\r\n            type: cc.AudioClip,\r\n            default: null\r\n        },\r\n        jumpStandByAudio:{\r\n            type: cc.AudioClip,\r\n            default: null\r\n        }\r\n    },\r\n\r\n    onLoad(){\r\n        this.jumpStandByAudioId = -1;\r\n        this.jumpAudioId = -1;\r\n        this.jumpId = -1;\r\n        this.isJump = false;\r\n        this.direction = 1;  //顺时针\r\n        this.power = 250;\r\n        this.maxDistance = 650;\r\n        this.distance = 0;\r\n        this.properties = 0.65;\r\n        this.speed = 100;\r\n\r\n        this.user = cc.find('rotateNode/user', this.node);\r\n        this.rotateNode = cc.find('rotateNode', this.node);\r\n        this.onJump = this.onJump.bind(this);\r\n        this.readyJump = this.readyJump.bind(this);\r\n    },\r\n\r\n    readyJump(){\r\n        if(this.isJump){\r\n            return;\r\n        }\r\n        this.isJump = true;\r\n        this.jumpStandByAudioId = cc.audioEngine.play(this.jumpStandByAudio, false, 1);\r\n        this.user.runAction(cc.scaleTo(1, 1, 0.5));\r\n    },\r\n\r\n    onJump(callback){\r\n        let targetPos = cc.v2(this.node.x + this.distance * this.direction, this.node.y + this.distance * this.properties);\r\n        this.jumpToBlock(targetPos, callback);\r\n    },\r\n\r\n    jumpToBlock(targetPos, callback){\r\n\r\n        cc.audioEngine.stop(this.jumpStandByAudioId);\r\n        this.jumpAudioId = cc.audioEngine.play(this.jumpAudio, false, 1);\r\n\r\n        this.user.stopAllActions();\r\n        let resetAction = cc.scaleTo(0.3, 1, 1);\r\n        let jumpAction = cc.jumpTo(0.5, targetPos, 150, 1);\r\n        let rotateAction = cc.rotateBy(0.5, this.direction * 360);\r\n        this.user.runAction(resetAction);\r\n        this.rotateNode.runAction(rotateAction);\r\n        this.node.runAction(cc.sequence(jumpAction, cc.callFunc(() => {\r\n            this.rotateNode.rotation = 0;\r\n            this.direction = Math.random() < 0.5 ? 1 : -1;\r\n            this.distance = 0;\r\n            this.speed = 100;\r\n            callback && callback();\r\n        })));\r\n\r\n        this.isJump = false;\r\n    },\r\n\r\n    update(dt){\r\n        if(this.isJump){\r\n            if(dt && this.power && this.maxDistance){\r\n                this.speed += dt * this.power;\r\n                this.distance = this.speed + this.maxDistance * dt;\r\n            }\r\n        }\r\n    },\r\n\r\n    getWorldPlayerPos(){\r\n        return this.node.parent.convertToWorldSpaceAR(this.node.position);\r\n    },\r\n\r\n    getDirection(){\r\n        return this.direction;\r\n    }\r\n});\r\n"]}